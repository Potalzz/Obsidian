## 위시리스트
### 공통
- [ ] 방 선택할 수 있는 목록화면
      추가로 방 여러개 해놓고 Comming Soon 해놓기
- [ ] 플레이타임, 문제별 풀이 시간 측정해서 결과로 보여주기
- [ ] GameCenter 도입해서 랭킹제도

### 병원 방탈출
- [ ] 아키텍쳐에 맞춰서 리팩토링
- [ ] 손모양 인식해서 상호작용
- [ ] 방 조도를 라이팅으로 조정하고, 방 진입하면 2깜빡거리다가 불켜지게

## 수면가스 개발
### 개요
수면가스 모니터를 핀치하면 수면가스 모니터를 조작할 수 있는 windowr기반의 UI가 나오고, 수면가스 모니터 위에 있는 화면과 상호작용하여 값이 변경되게 한다.

#### 개발 순서
피그마 수면가스 모니터 이미지 가져옴
이미지 가져와서 윈도우 뷰로 모니터 위에 띄우기
윈도우 뷰에서 +-버튼 상호작용 테스트
모니터에 윈도우 화면 붙이기

**swiftUI뷰에 버튼에 따라 숫자 조작하고 변경되게**
**Attachment에 모니터 붙이기**
**모니터뷰에서 3,6,9맞으면 활성화 이미지 표시**
**숫자 맞으면 연기 particle나오도록**

ECS와 MVVM이 결합된 코드 살펴보기
### 기능 목록
- [x] 핀치를 통한 수면가스 모니터 선택
      tabGesture로 선택
- [x] 모니터가 선택되면 window화면이 나온다
      tabGesture를 통해 bolean으로 판별
	- [x] swiftUI로 조작할 수 있는 윈도우 화면을 제작한다
- [x] 수면가스 모니터 에셋 위에 Attachment를 통해 swiftUI 화면을 올린다
      비율에 맞춰서 폰트 크기 줄어들도록 구현
- [x] 모니터 화면에서 특정 숫자가 되면 수면가스가 나온다
- [ ] 정답 맞추면 수면가스 모니터 닫히기
- [ ] 수면가스 위치가 모니터 z축 앞으로 나오게 구현
- [ ] window view띄울 때 opacity fade in & out을 추가
- [ ] 동작에 맞게 사운드가 재생된다


### 체크리스트
- [x] 모니터 이미지 파일 +,-, 따로 받아서 뷰에 반영하기
- [ ] 새로운 수면가스 기기에 클릭했을 때 모달 나오게 하려면, 파일명과 메쉬명 겹치는 부분 없도록하기
- [ ] ~~침대랑 연기에 충돌 설정~~

### 이슈
#### 진행중
##### swiftUI View를 Attachments로 띄웠을 때 버튼에 hover효과가 버튼 크기와 다르게 적용되는 문제
1. RealityView의 attachments는 2D View를 3D 공간에 투영하는 원리이므로, 프레임 해상도와 스케일이 달라진다.
2. Immersive 환경에서는 View가 **디바이스에서 재투영(render-to-texture)** 되면서  `SwiftUI`에서 본 UI 비율과 실제 `RealityKit` 상의 UI 비율이 **달라짐**
3. visionOS는 버튼에 **자동 hoverEffect (visual affordance)** 를 추가하는데,이 효과는 "화면상 View의 크기 기준"으로 적용되므로 RealityView에서 **스케일이 줄어들면 hover 원도 더 작게 보임**

**해결 방안 1. 버튼을 교체해서 호버 효과 대체**
hover와 커서 효과를 모두 제거하고, 포커스 받을 때 색상이나 크기를 바꾸는 커스텀 뷰로 대체한다.

-> 근본적으로 문제를 해결하는 것이 아니라 버튼에 대해서만 꼼수로 적용

**해결 방안 2. 개별 Entity로 불러오기**
각기 버튼마다 Enity로 만들어서 불러오기.

-> immersiveView를 띄우는 화면에 불러오는 코드가 너무 많고 복잡해짐. 따로 모듈화가 가능해야함.


**++ 버튼 클릭할 때 버튼이 흔들리는 문제도 발생**





#### 해결
- [x] 모니터 위에 모달 띄우는 것은 가능한데, 모니터 축이 화면 중앙에 있음
      에셋 새로 불러와서 설정

##### 제스처 여러개 등록하면 가장 위 제스처만 동작
``` swift
.simultaneousGesture(
    TapGesture(target: "Plane_008", showModal: $showPasswordModal)
)
```

`simultaneousGesture`를 통해서 해결

##### smokeParticle이 올바르게 재생되지 않음
RCP에서 씬 안에 넣어서 가져오는 방식으로는 재대로 가져와지지 않음.
Timeline생성하고 Reference에 Fog파티클 넣어주니까 인식하는 것 같음.
대신, 해당 방식으로 가져오면 원점에 배치되어서 가져온다음 코드로 위치 조정.


## ARKit 공간 가이드라인
### 개요
ARKit을 활용해 공간 확보 가이드라인 UI 및 기능을 구현한다.

#### 앱 동작 흐름
앱 실행 -> 블랙 배경에 경고 화면 문구 비동기로 띄우기(window) -> 바닥에 가이드라인(mixed ar) -> 방탈출 씬 로드(mixed ar)

스플래시 화면(fade in&out) `-5초 후->` 가이드라인 뷰 `-확인->` 메인 화면 `-게임 시작->` 블랙화면 `-6초후->` 방탈출 화면 `-게임 종료->` 메인 화면

#### 구현에 필요한 개념
- [[앱 시작점과 화면 전환 관련 개념]]


**가이드라인 좌표**
`guideLinePosition: SIMD3<Float> = SIMD3(-0.05962, 0.32094, 0.01392)`

### 기능 목록
- [ ] 가이드라인 WindowUI 만들기

- [ ] 앱이 실행되면 AR환경이 자동으로 실행되도록 한다.

- [ ] AR환경에서 사용자의 발바닥 높이에 맞춰서 가이드라인을 표시해준다.

- [ ] 가이드라인을 마치고 게임 시작 버튼을 통해 방탈출 씬이 load되도록 한다.


### 체크리스트
**처음 앱 실행되는 상태를 어떤걸로해야 할까 ?**
시작할 때 AR환경에서 시작해서 바로 바닥에 가이드라인 띄우도록 ?
가이드라인을 띄우면, 주변 환경을 인식하기보다, 그냥 수평으로 발바닥 높이에 띄워주면 됨.
그러면은 기존에 immersive전환 버튼을 통해 진입하는 방식에서, 바로 가이드라인 씬을 로드해주고 거기서 버튼을 통해서 방탈출 씬으로 접근할 수 있도록.

어차피 둘다 mixedAR환경이다. 띄워주는 에셋만 다르게 해주면 됨.



### 이슈
#### 진행중


#### 해결

## 마지막 체크리스트
- [ ] 게임 클리어하면 강제종료 후 메인화면으로 이동 후 화면 정면에 나오게
- [ ] 전체적인 볼륨 레벨
- [ ] 게임 시작 사운드 싱크 맞는지
- [ ] 박스 안에 물체 안집히는지
- [ ] ar가이드라인 크기 일치하는지
- [ ] 블랙돔에셋 아이퍼 RCP에 있는 설정 맞추기