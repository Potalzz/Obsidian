## FCM(Firebase Cloud Messaging)
>무료로 메시지를 안정적으로 전송할 수 있는 교차 플랫폼 메시징 솔루션.

### FCM이 무엇인가 ?
- **FCM**은 **Firebase Cloud Messaging**의 약자로, 무료로 메시지를 안정적으로 전송할 수 있는 교차 플랫폼 메시징 솔루션이다.
- 모든 사용자에게 알림 메세지를 전송할 수도 있고, 그룹을 지어 메시지를 전송할 수도 있다.
- Firebase의 서비스는 요금 정책에 따라, 이용할 수 있는 범위가 다르지만 FCM은 요금 정책에 구분 없이 무료로 사용하는 것이 가능하다.

### 왜 FCM을 사용해서 Push 메시지를 보낼까 ?
>FCM은 교차 플랫폼 메시지 솔루션이기 때문에, FCM을 이용해서 개발을 진행하면, iOS, Android, Web 등의 플랫폼에 종속되지 않고 Push 메시지를 전송할 수 있다.

또한, 메시지를 전달함에 있어서 클라우드 메시징 서버를 사용하지 않으면 어플리케이션 서버에서 메시지를 전달받기 때문에 실시간으로 메시지를 전달받기 위해서는 실시간으로 서버에 계속 접속해 있어야 한다. 이러한 경우 많은 배터리와 네트워크 사용으로 문제가 발생할 수 있다.

 **클라우드 메시징 서비스**를 이용하면, 클라우드 메시징 서버를 중간에 둠으로써, 사요앚는 낮은 배터리와 네트워크의 사용만으로도 메시지를 실시간으로 송수신 처리할 수 있다.



### FCM의 주요 특징

#### 메시지 타입
>FCM의 메시지 타입은 **알림 메시지**와 **데이터 메시지**로 구분할 수 있다.

일반적으로 알림 메시지와 데이터 메시지를 같이 혼용해서 사용한다.
- `Ex)` 휴대폰 **푸시 알림 메시지는 알림 메시지를 이용**하고, 알림 메시지를 클릭 했을 때 앱 내 특정 페이지로 이동이나, 어떠한 액션은 데이터 메시지를 통해서 이뤄진다.

| 메시지 유형      | 전달 경로          | 처리 주체        | 설명                                                   |
| ----------- | -------------- | ------------ | ---------------------------------------------------- |
| **알림 메시지**  | FCM → OS → 사용자 | **운영체제(OS)** | 메시지를 자동으로 알림 형태로 표시함. 앱이 꺼져 있어도 가능                   |
| **데이터 메시지** | FCM → 앱 직접 처리  | **앱 코드**     | 알림 표시 여부나 행동은 앱이 직접 처리. 앱이 열려 있어야 함 (백그라운드 또는 포그라운드) |

**알림 메시지 예시**
- 앱 상태와 무관하게 사용자에게 알림을 보여주고 싶을 때
- `Ex)` 공동구매 앱에서 새 모집글 등록 시

**데이터 메시지 예시**
- 앱 내에서 커스텀 동작이나 UI 처리를 해야 할 때
- `Ex)`실시간 참여자 수 업데이트, 채팅, 이벤트 처리 등


#### 타겟팅
>**단일 기기**, **기기 그룹**, **주제를 구독한 기기** **3가지 방식**으로 클라이언트 앱에 메시지를 배포할 수 있다.

| 종류    | 대상수   | 설명            |
| ----- | ----- | ------------- |
| 단일 기기 | 1개    | 하나의 기기(앱 기준)  |
| 기기 그룹 | 20개   | 알림 키에 허용되는 그룹 |
| 주제 구독 | 1000개 | 등록 토큰에 구독된 기기 |

**클라이언트 앱에서 메시지 전송**
- FCM을 이용하면 앱 서버에서 클라이언트 앱으로 다운 스트림 메세지를 보낼 수 있을 뿐만 아니라, 클라이언트 앱에서 앱 서버로도 업 스트림 메세지를 보낼 수 있다.
- 하지만 클라이언트 앱에서 앱 서버로 업 스트림 메세지를 보내기 위해서는 선행 조건이 필요하다. 그 부분은 밑에서 설명한다

#### FCM의 동작 원리
>크게 송신자, FCM Backend Server, 수신자로 구분한다.
>![[Pasted image 20250529213944.png]]
>[FCM 공식 문서](https://firebase.google.com/docs/cloud-messaging?hl=ko)_


